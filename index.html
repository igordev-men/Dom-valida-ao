<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Descubra sua média</title>
</head>
<body class="min-h-screen">
  <header class="flex justify-center items-center gap-4 p-5 flex-col">
    <h2 class="text-3xl font-bold text-gray-800 text-center p-5">
      Calcule sua média do bimestre
    </h2>
    <button type="button" id="ComoFunciona"
      class="rounded bg-orange-500 px-5 py-2 text-sm font-semibold text-white hover:bg-orange-700">
      Como funciona?
    </button>
  </header>

  <main class="space-y-6">
    <!-- bloco "Como funciona" -->
    <section id="Funciona" class="flex justify-center items-center p-5 hidden">
      <p class="max-w-2xl text-center text-gray-700">
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Possimus voluptas temporibus, ullam
        aliquid doloribus illum enim iste molestiae velit ipsum, architecto accusantium illo obcaecati
        asperiores quo doloremque voluptate, iure eveniet.
      </p>
    </section>

    <!-- botões -->
    <nav class="flex items-center justify-center">
      <ul class="flex items-center justify-center gap-5">
        <li>
          <button type="button" id="inserirDados" class="text-orange-600 p-3 hover:text-orange-400">
            Adicione os dados
          </button>
        </li>
      </ul>
    </nav>

    <!-- tabela -->
    <section class="flex justify-center p-5">
      <table class="border-collapse border border-gray-300">
        <thead class="bg-gray-100">
          <tr>
            <th class="border border-gray-300 px-3 py-2">Nome</th>
            <th class="border border-gray-300 px-3 py-2">Nota 1</th>
            <th class="border border-gray-300 px-3 py-2">Nota 2</th>
            <th class="border border-gray-300 px-3 py-2">Média</th>
          </tr>
        </thead>
        <tbody id="corpoTabela"></tbody>
      </table>
    </section>

    <div class="flex justify-center">
      <button type="button"
        class="rounded bg-green-500 px-5 py-2 text-sm font-semibold text-white hover:bg-green-700"
        onclick="exportToXML()">
        Exportar tabela
      </button>
    </div>

    <!-- modal -->
    <section id="modal-questions" class="flex justify-center items-center p-5">
      <div id="modal-content"
        class="relative flex flex-col items-center bg-orange-200 p-6 gap-4 rounded-lg w-full max-w-md hidden">
        <button type="button" id="close" class="absolute top-2 right-3 text-xl text-red-700 cursor-pointer">&times;</button>
        <h4 id="pergunta-h4" class="font-semibold text-orange-900 text-center">
          Qual é o aluno?
        </h4>
        <input type="text" id="DadosInseridos" placeholder="Digite aqui..." class="w-full border rounded px-3 py-2 text-center">
        <button id="proxima"
          class="rounded bg-orange-500 px-5 py-2 text-sm font-semibold text-white hover:bg-orange-700">
          Confirmar
        </button>
      </div>
    </section>
  </main>

  <script>
    // Referências
    const textF = document.getElementById('Funciona');
    const btnF = document.getElementById('ComoFunciona');
    const btnAdicionarDados = document.getElementById('inserirDados');
    const proxima = document.getElementById('proxima');
    const modalRespostas = document.getElementById('modal-content');
    const closeBtn = document.getElementById('close');
    const perguntaElemento = document.getElementById('pergunta-h4');
    const inputDados = document.getElementById('DadosInseridos');
    const corpoTabela = document.getElementById('corpoTabela');

    // Perguntas
    const perguntas = [
      { id: 0, texto: 'Qual o nome do aluno?' },
      { id: 1, texto: 'Qual é a primeira nota?' },
      { id: 2, texto: 'Qual é a segunda nota?' }
    ];

    let indicePerguntaAtual = 0;
    let respostas = {};

    // Mostrar/ocultar "Como funciona"
    btnF.addEventListener('click', () => {
      textF.classList.toggle('hidden');
    });

    // Abrir modal e iniciar fluxo
    btnAdicionarDados.addEventListener('click', () => {
      modalRespostas.classList.remove('hidden');
      indicePerguntaAtual = 0;
      respostas = {};
      mostrarProximaPergunta();
    });

    // Confirmar resposta
    proxima.addEventListener('click', () => {
      const perguntaAtual = perguntas[indicePerguntaAtual].texto;
      const valor = inputDados.value.trim();

      if (!valor) {
        inputDados.focus();
        return;
      }

      respostas[perguntaAtual] = valor;
      indicePerguntaAtual++;
      inputDados.value = '';
      mostrarProximaPergunta();
    });

    // Fechar modal
    closeBtn.addEventListener('click', () => {
      modalRespostas.classList.add('hidden');
    });

    
    function mostrarProximaPergunta() {
      if (indicePerguntaAtual < perguntas.length) {
        perguntaElemento.textContent = perguntas[indicePerguntaAtual].texto; 
        inputDados.focus();
      } else {
        // terminou: cria a linha na tabela e fecha o modal
        criarLinhaTabela();
        modalRespostas.classList.add('hidden');
      }
    }

    function criarLinhaTabela() {
      const tr = document.createElement('tr');

      const nome = respostas['Qual o nome do aluno?'] || '';
      const n1 = parseFloat(respostas['Qual é a primeira nota?'] || '0');
      const n2 = parseFloat(respostas['Qual é a segunda nota?'] || '0');
      const media = ((n1 + n2) / 2).toFixed(2);

      [nome, n1, n2, media].forEach(val => {
        const td = document.createElement('td');
        td.className = "border border-gray-300 px-3 py-2 text-center";
        td.textContent = val;
        tr.appendChild(td);
      });

      corpoTabela.appendChild(tr);
    }

    function exportToXML() {
      const tabela = document.querySelector('table');
      const corpo = document.getElementById('corpoTabela');
      if (!corpo || corpo.rows.length === 0) {
        alert('A tabela está vazia. Adicione dados antes de exportar.');
        return;
      }

      const cabecalhos = Array.from(tabela.querySelectorAll('thead th')).map(th =>
        th.textContent.toLowerCase().trim().replace(/\s/g, '_')
      );

      const linhas = corpo.querySelectorAll('tr');
      let xmlString = '<?xml version="1.0" encoding="UTF-8"?>\n<registros>\n';

      linhas.forEach(linha => {
        xmlString += '  <registro>\n';
        const celulas = linha.querySelectorAll('td');
        cabecalhos.forEach((cabecalho, index) => {
          const valor = (celulas[index]?.textContent || '').trim();
          xmlString += `    <${cabecalho}>${valor}</${cabecalho}>\n`;
        });
        xmlString += '  </registro>\n';
      });

      xmlString += '</registros>';

      const blob = new Blob([xmlString], { type: 'application/xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dados_tabela.xml';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      console.log('Exportação para XML concluída!');
    }

    
    window.exportToXML = exportToXML;
  </script>
</body>
</html>
